% !TEX TS-program = xelatex
% !TEX encoding = UTF-8 Unicode
\documentclass{article}
\usepackage{gap-civl}
\usepackage{subfiles}

% SEE: https://tex.stackexchange.com/questions/132582/transparent-foreground-watermark
\newsavebox\draftbox
\savebox\draftbox{\tikz[color=red,opacity=0.1]\node{DRAFT};}
\newwatermark*[
  allpages,
  angle=45,
  scale=6,
  xpos=-20,
  ypos=15
]{\usebox\draftbox}

% SEE: https://ctan.org/pkg/titlepages
\newcommand*{\titleGap}{\begingroup
\raggedleft
\vspace*{16\baselineskip}

\begin{tabularx}{\textwidth}{@{}rXr@{}}
    \textit{Fédération} & & \\
    \textit{Aéronautique} & & \multirow{2}{*}{} \\ \cline{2-3}
    \textit{Internationale} & & \\
\end{tabularx}

{\Huge CIVL GAP}\\
{\Huge Annex to Section 7A}\\
\vspace*{2\baselineskip}
{\Large Centralised Cross-Country Competition Scoring for}\\
{\Large Hang-Gliding and Paragliding}\\
{\Large Classes 1 to 5}\\
\vspace*{2\baselineskip}
2018 Edition\\
Work in Progress, Draft\\
\vspace*{10\baselineskip}

\begin{tabularx}{\textwidth}{@{}rXr@{}}
    \textit{Maison du Sport International} & & \\
    \textit{Av. de Rhodanie 54} & & \\
    \textit{CH-1007 Lausanne} & & \\
    \textit{(Switzerland)} & & \\
    \textit{Tél. +41 (0)21 345 10 70} & & \\
    \textit{Fax +41 (0)21 345 10 77} & & \\
    \textit{E-mail: \href{mailto:sec@fai.org}{sec@fai.org}} & & \\
    \textit{Web: \href{www.fai.org}{www.fai.org}} & & \\
\end{tabularx}

\endgroup}

\import{}{gap-footer}
\pagestyle{gen}

\begin{document}
% NOTE: I've figured out a different solution which may come in handy.
% Basically its a way to make every subfile point to the main directory for
% a valid relative path if its compiled on its own. This solution works for
% files as well as pictures.
% SEE: http://latex.org/forum/viewtopic.php?t=13267
\newcommand{\main}{.}
\import{}{gap-header}

% SEE: http://tex.stackexchange.com/questions/86249/maketitle-text-before-title
{\let\newpage\relax\titleGap}\thispagestyle{pageone}

\newpage
\vspace*{\fill}
\section*{FEDERATION AERONAUTIQUE INTERNATIONALE\\MSI – Avenue de Rhodanie 54 – CH-1007 Lausanne – Switzerland}
\subfile{sec-copyright}

\newpage
\section*{RIGHTS TO FAI INTERNATIONAL SPORTING EVENTS}
\subfile{sec-rights}

\newpage
\section*{Change Log}
\subfile{sec-change-log}

\newpage
\tableofcontents

\newpage
\section{Introduction}
\subfile{sec-introduction}

\newpage
\section{The GAP Philosophy}
\subfile{sec-philosophy}

\newpage
\section{Definitions}
\subfile{sec-definitions}

\newpage
\section{Use of Tracklog Data}
\subfile{sec-use-of-tracklog-data}

\newpage
\section{Competition Parameters}
\subfile{sec-comp-parameters}

\newpage
\section{Task Setting}
\subfile{sec-task-setting}

\newpage
\section{Flying a task}
\subfile{sec-flying-a-task}

\newpage
\section{Task evaluation}
\subfile{sec-task-evaluation}

\newpage
\section{Task Validity}
\subfile{sec-task-validity}

\newpage
\section{Points Allocation}
\subfile{sec-points-allocation}

\newpage
\section{Pilot score}
\subfile{sec-pilot-score}

\newpage
\section{Special cases}
\subfile{sec-special-cases}

\newpage
\section{Task ranking}
\subfile{sec-task-ranking}

\newpage
\section{Competition ranking}
\subfile{sec-comp-ranking}

\newpage
\section{FTV - Fixed Total Validity}
\subfile{sec-fixed-total-validity}

\newpage
\appendix
\appendixpage
\addappheadtotoc

\section{Flare Timing Scoring Steps}
\subfile{apx-flare-timing}

\newpage
\section{Variations of GAP}
\subfile{apx-gap-variants}

\newpage
\section{Default Parameters of GAP}
\subfile{apx-gap-defaults}

\newpage
\section{Shortest Route}
\subfile{apx-shortest-route}

\newpage
\section{Real Leading Points}
\subfile{apx-real-leading}

\end{document}
