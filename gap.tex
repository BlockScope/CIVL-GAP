% !TEX TS-program = xelatex
% !TEX encoding = UTF-8 Unicode
\documentclass{article}
\usepackage{civl}

% SEE: https://ctan.org/pkg/titlepages
\newcommand*{\titleGap}{\begingroup
\raggedleft
\vspace*{16\baselineskip}

\begin{tabularx}{\textwidth}{@{}rXr@{}}
    \textit{Fédération} & & \\
    \textit{Aéronautique} & & \multirow{2}{*}{} \\ \cline{2-3}
    \textit{Internationale} & & \\
\end{tabularx}

{\Huge CIVL GAP}\\
\vspace*{2\baselineskip}
{\Large Centralised Cross-Country Competition Scoring for}\\
{\Large Hang-Gliding and Paragliding}\\
\vspace*{2\baselineskip}
2016 Edition\\
Revision 1.1\\
Published February 26, 2017\\
\vspace*{10\baselineskip}

\begin{tabularx}{\textwidth}{@{}rXr@{}}
    \textit{Maison du Sport International} & & \\
    \textit{Av. de Rhodanie 54} & & \\
    \textit{CH-1007 Lausanne} & & \\
    \textit{(Switzerland)} & & \\
    \textit{Tél. +41 (0)21 345 10 70} & & \\
    \textit{Fax +41 (0)21 345 10 77} & & \\
    \textit{E-mail: \href{mailto:sec@fai.org}{sec@fai.org}} & & \\
    \textit{Web: \href{www.fai.org}{www.fai.org}} & & \\
\end{tabularx}

\endgroup}

\import{}{footer}
\pagestyle{gen}

\begin{document}
\import{}{header}

% SEE: http://tex.stackexchange.com/questions/86249/maketitle-text-before-title
{\let\newpage\relax\titleGap}\thispagestyle{pageone}

\newpage
Editor's note: Hang-gliding and paragliding are sports in which both men and women participate. Throughout this document the words "he", "him" or "his" are intended to apply equally to either sex unless it is specifically stated otherwise.\\

\begin{tabularx}{\textwidth}{|l|l|X|}
 \hline
    \textbf{Revision} & \textbf{Author} & \textbf{Changes} \\
 \hline
 2014 R1.1 & Joerg Ewald & Correction of a number of typos \\
 \hline
 2015 R1.0 & Joerg Ewald & Added changes from the 2015 CIVL Plenary:
    \begin{itemize}
        \item Use same leading coefficient calculation for both hang gliding and paragliding
        \item Use QNH for altitude measurement
        \item Final glide decelerators in paragliding no longer mandatory
        \item Distance measurement based on WGS84 ellipsoid postponed
    \end{itemize} \\
 \hline
 2016 R1.0 & Joerg Ewald & Added changes from the 2016 CIVL Plenary:
    \begin{itemize}
        \item PG: Double the amount of available leading points (reducing time points accordingly)
        \item PG: If no pilot in goal, the leading points weight is proportional to the task distance covered by pilots, up to 100 points.
        \item HG: Jump the gun penalty is now one point for every 2 seconds (was for every 3 seconds).
    \end{itemize} \\
 \hline
 2014 R1.1 & Joerg Ewald & Correct Figures 6 and 7 (point allocation graphs) \\
\hline
\end{tabularx}

\vspace*{\fill}
\section*{FEDERATION AERONAUTIQUE INTERNATIONALE}
\textbf{Maison du Sport International – Avenue de Rhodanie 54 – CH-1007 Lausanne – Switzerland}\\
Copyright 2014\\
All rights reserved. Copyright in this document is owned by the Fédération Aéronautique Internationale (FAI). Any person acting on behalf of the FAI or one of its Members is hereby authorised to copy, print, and distribute this document, subject to the following conditions:\\
\textbf{
    \begin{enumerate}
        \item The document may be used for information only and may not be exploited for commercial purposes.\\
        \item Any copy of this document or portion thereof must include this copyright notice.
    \end{enumerate}
}

\newpage
Note that any product, process or technology described in the document may be the subject of other Intellectual Property rights reserved by the Fédération Aéronautique Internationale or other entities and is not licensed hereunder.

\newpage
\tableofcontents

\newpage
\section{Introduction}
\subsection{Scope}
\subsection{Sources}
\subsection{Changes from previous edition}
\subsection{Differences between Hang-Gliding and Paragliding}

\newpage
\section{The GAP Philosophy}
\subsection{History}
\subsection{Scoring Process}

\newpage
\section{Definitions}
\subsection{Flights}
\subsection{Locations and distances}
\subsection{Times}

\newpage
\section{Use of Tracklog Data}
\subsection{Position}
\subsection{Distance}
\label{sec:distance}
In general, task evaluation occurs in the \(x/y\) plain, therefore distance
measurements are always exclusively horizontal measurements. The earth model used
is the FAI sphere, with a radius of 6371.0 km.

\colorbox{pgc}{\begin{minipage}{\textwidth}
In paragliding, for final glide decelerators (\ref{sec:final-glide-decelerators})
and altitude bonus in stopped tasks (\ref{sec:distance-stopped-tasks}), altitude
is also considered, but this does not affect distance calculations between two
geographic points.
\end{minipage}}
\marginpar{\includegraphics[scale=0.6]{pg.png}\hfill}

\colorbox{hgc}{\begin{minipage}{\textwidth}
In hang gliding, for altitude bonus in stopped tasks (\ref{sec:distance-stopped-tasks}),
altitude is also considered, but this does not affect distance calculations between
two geographic points.
\end{minipage}}
\marginpar{\includegraphics[scale=1.2]{hg.png}\hfill}

The distance between two points, identified by their radian coordinates
\(lat_1/long_1\) and \(lat_2/long_2\), is calculated using the Haversine formula.
\begin{align*}
    distLat &= lat_2 - lat_1 \\
    distLong &= long_2 - long_1 \\
    a &= \sin(\frac{distLat}{2})^2 + \cos lat_1 * \cos lat_2 * \sin(\frac{distLong}{2})^2 \\
    radianDistance &= 2 * \atantwo(\sqrt a, \sqrt{1 - a}) \\
    distance &= radianDistance * 6371000 \\
\end{align*}
To reproduce this formula in Excel, the following modification is necessary due to a different
implementation of the \(arctan2\) function:
\[ radianDistance = pi - 2 * \atantwo(\sqrt a, \sqrt{1 - a}) \]

\subsection{Altitude}
\subsection{Time}

\newpage
\section{Competition Parameters}
\subsection{Nominal Launch}
\subsection{Nominal Distance}
\subsection{Minimum Distance}
\subsection{Nominal Goal}
\subsection{Nominal Time}
\subsection{Final Glide Decelerator}
\label{sec:final-glide-decelerators}
\subsection{Score-back Time}

\newpage
\section{Task Setting}
\subsection{Definition of a task}
\subsubsection{Race task}
\subsubsection{Open distance task}
\subsection{Definition of control zones}
\subsubsection{Definition of a turnpoint cylinder}
\subsubsection{Definition of conical end of speed section}
\subsection{Definiton of goal}
\subsubsection{Goal line}
\subsection{Start procedures}
\subsubsection{Air start}
\subsubsection{Ground start}
\subsubsection{Race to goal}
\subsubsection{Elapsed time}
\subsection{Distances}
\subsubsection{Task distance}
\label{sec:task-distance}
\subsubsection{Speed section distance}

\newpage
\section{Flying a task}
\subsection{Race task}
\subsection{Open distance task}

\newpage
\section{Task evaluation}
\subsection{Reaching a control zone}
\subsubsection{Reaching a turnpoint cylinder}
A cylinder is considered “reached” by a pilot if that pilot’s track log shows the pilot crossing out of the
cylinder in the case of an exit cylinder, or into the cylinder in case of an enter cylinder, by containing at
least one track point closer to the cylinder’s centre than the cylinder radius (enter) or further away from
the cylinder’s centre than the cylinder radius (exit). During task evaluation, only the \(x/y\) coordinates are
considered, and a point must lie within (enter) or outside of (exit) the circle representing the turnpoint
cylinder in the \(x/y\) plain. This is determined by measuring the distance between a track point and the
turnpoint. This distance must be greater (exit) or smaller (enter) than the cylinder’s radius.
To compensate for different distance calculations and different earth models in use by today’s GPS
devices (FAI sphere vs. WGS84 ellipsoid), a 0.5\% tolerance is used for this calculation. This had to be
introduced so that a pilot reading the distance to the next cylinder centre from his GPS device can rely
on having reached the turnpoint when the distance displayed by the instrument is smaller than the
defined turnpoint cylinder radius.

For enter cylinders, this means that a tracklog point that is closer to the turnpoint than \(r*1.005\) is
considered proof of reaching the turnpoint. For exit cylinders, this means that a tracklog point that is
further away from the turnpoint than \(r*0.995\) is considered proof of reaching the turnpoint.
Starting January 1st, 2015 – provided all distance measurements are then based on the WGS84 ellipsoid
(see~\ref{sec:distance}) – the tolerance for turnpoint cylinders in CIVL’s FAI Category 1 events will be reduced to 0.01\%
of the cylinder radius, with a minimum of 5 meter. Organisers of FAI Category 2 events may continue
using the existing 0.5\% tolerance, to accommodate pilots flying with instruments which calculate
distance based on the FAI sphere.

The time when a control zone was reached is determined by the time a so-called “crossing” occurred. A
crossing is defined as a pair of consecutive track points, of which at least one lies inside the band
determined by the turnpoint’s centre, its radius and the tolerance value.
\begin{align*}
    tolerance &= 0.5\% | 0.01\% \\
    minTolerance &= 0m | 5m \\
    turpoint_i : innerRadius_i &= \min(radius_i * (1 - tolerance), radius_i - minTolerance) \\
    turpoint_i : outerRadius_i &= \max(radius_i * (1 + tolerance), radius_i + minTolerance) \\
\end{align*}
\begin{equation*}
    crossing_i = \exists_j (a \land b) \lor (c \land d)
\end{equation*}
\begin{align*}
    a = distance(center_i, trackpoint_j) &>= innerRadius_i \\
    b = distance(center_i, trackpoint_{j+1}) &<= outerRadius_i \\
    c = distance(center_i, trackpoint_j) &<= outerRadius_i \\
    d = distance(center_i, trackpoint_{j+1}) &>= innerRadius_i \\
\end{align*}
The time of a crossing depends on whether it actually cuts across the actual cylinder, or whether both
points lie within the tolerance band, but on the same side of the actual cylinder.
\begin{align*}
    crossing . time &= trackpoint_{j+1} . time \ when \ A \\
    crossing . time &= trackpoint_j . time \ when \ B \\
    crossing . time &= interpolateTime(trackpoint_{j+1}, trackpoint_{j+1}) . time \ when \ C \\
\end{align*}
\begin{align*}
    A &= (a \land b) \lor (c \land d) \land turnpoint_i = ESS \\
    B &= (a \land b) \lor (c \land d) \land turnpoint_i \neq ESS \\
    C &= (a \land d) \lor (c \land b) \\
    \\
    a = distance(center_i, trackpoint_j) &< radius_i \\
    b = distance(center_i, trackpoint_{j+1}) &< radius_i \\
    c = distance(center_i, trackpoint_j) &> radius_i \\
    d = distance(center_i, trackpoint_{j+1}) &> radius_i \\
\end{align*}
The method used to interpolate the crossing time is buried in FS’ code and will have to be documented
at a later point.

Finally, given all n crossings for a turnpoint cylinder, sorted in ascending order by their crossing time, the
time when the cylinder was reached is determined.
\begin{align*}
    turnpoint_i &= SSS : reachingTime_i = crossing_n . time \\
    turnpoint_i &\neq SSS : reachingTime_i = crossing_0 . time
\end{align*}
\subsection{Reaching a conical end of speed section}
\subsection{Reaching goal}
\subsubsection{Goal cylinder}
\subsubsection{Goal line}

\subsection{Flown distance}

\subsubsection{Race task}
\label{sec:race-task}
To determine a pilot’s flown distance, a first step determines which turnpoints he reached considering
all timing restrictions: launch within launch time window, valid start, but only until the task deadline
time. After the last turnpoint the pilot reached, for every remaining track point, the shortest distance to
goal is calculated using the method described in section \ref{sec:task-distance}. The flown distance is then calculated as
task distance minus the shortest distance the pilot still had to fly. Therefore, for scoring, the pilot’s best
distance along the course line is considered, regardless of where the pilot landed in the end.

If a pilot flies less than minimum distance, he will be scored for this minimum distance. This also applies
to pilots who are not able to produce a valid GPS tracklog, but for whom launch officials verify launch
within the launch window.

If a pilot reaches goal, he will be scored for the task distance.
\begin{align*}
    \forall p : p \in PilotsLandingBeforeGoal : bestDistance_p &= \max(minimumDistance, taskDistance - shortest) \\
    shortest &= \min(\forall track_p . point_i shortestDistanceToGoal(track_p . point_i))) \\
    \forall p : p \in PilotsReachingGoal : bestDistance_p &= taskDistance
\end{align*}

\subsubsection{Open distance task}
In an open distance task, if a pilot lands before the last of any given control zones, his flown distance is
calculated according to \ref{sec:race-task}. For pilots flying further than the last control zone, the flown distance is
calculated by adding the pilot’s best distance flown in the open distance part of the task (after the last
control zone) to task distance between launch and the last control zone. If the task gave a direction for
the open distance leg, then the pilot’s best distance projected onto that direction is considered.

\subsection{Time for speed section}
The time a pilot took to fly the speed section is determined by his start time (which is influenced by the
task’s start procedure and the time he crossed the start of speed section cylinder) and the time when he
crossed the end of speed section after reaching all previous turn points. The smallest unit for time
measurement is one second.

Pilots who do not reach the end of speed section cylinder do not get a time.
\begin{align*}
    \forall p : p \in PilotsReachingESS : time_p &= timeAtESS_p - startTime_p
\end{align*}
If AATB is used, pilots receive a time bonus for their altitude above goal when crossing the ESS cylinder.
The number of seconds they receive for each meter is expressed by the ATTB factor.

By default, the ATTB factor is \(0.45 \ s/m\). Values suggested for use are between \(0.2 \ s/m\) and \(0.7 \ s/m\).
\begin{align*}
    \forall p : p \in PilotsReachingESS \\
    arrivalAltitudeTimeBonus_p &= (crossing_{p.ESS} . altitude - goal . altitude) * ATTBfactor \\
    time_p &= timeAtESS_p - startTime_p - arrivalAltitudeTimeBonus_p
\end{align*}

\newpage
\section{Task Validity}
The task validity is a value between 0 and 1 and measures how suitable a competition task is to evaluate
pilots’ skills. It is calculated for each task after the task has been flown, by multiplying the three validity
coefficients: Launch validity, distance validity, and time validity.
\begin{equation*}
    TaskValidity = LaunchValidity * DistanceValidity * TimeValidity
\end{equation*}

\subsection{Launch Validity}
Launch validity depends on nominal launch and the percentage of pilots actually present at take-off who
launched. If the percentage of pilots on take-off who launch is equal to nominal launch, or higher, then
launch validity is 1. If, for example, only 20\% of the pilots present at take-off launch, launch validity goes
down to about 0.1.

The reasoning behind launch validity: Launch conditions may be dangerous, or otherwise unfavourable.
If a significant number of pilots at launch think that the day is not worth the risk of launching, then the
gung-ho pilots who did go will not get so many points. This is a safety mechanism.

‘Pilots present’ are pilots arriving on take-off, with their gear, with the intention of flying. For scoring
purposes, ‘Pilots present’ are all pilots not in the ‘Absent’ status (ABS): Pilots who took off, plus pilots
present who did not fly (DNF). DNFs need to be attributed carefully. A pilot who does not launch due to
illness, for instance, is not a DNF, but an ABS.
\begin{align*}
    LVR &= \min(1, \frac{NumberOfPilotsFlying}{NumberOfPilotsPresent * NominalLaunch}) \\
    LaunchValidity &= 0.027 * LVR + 2.917 * LVR^2 - 1.944 * LVR^3
\end{align*}

\subsection{Distance Validity}
Distance validity depends on nominal distance, nominal goal, the longest distance flown and the sum of
all distances flown beyond minimum distance. If the task distance is quite short in relation to nominal
distance, the day is probably not a good measure of pilot skill because there would not be many
decisions to make.

If a task is longer than nominal distance, the day will not be devalued because of distance validity, even
if the nominal goal parameter value is not achieved, as long as a fair percentage of pilots fly a good
distance. This sounds like a vague statement, but the task setter should try to set tasks that are
reasonable for the day and achievable. If everyone lands in goal, you must ask if this was a valid test of
skill - it probably was if the fastest time and the distance flown were reasonably long. If everyone lands
short of goal, was it an unsuitable task but still a good test of pilot skill? You also can have the case
where a task that is shorter than nominal distance, has a distance validity of almost 1. This will happen
when a large percentage of the pilots fly a large percentage of the course but, in this case, you still have
a practical devaluation because there will be little spreading between pilots’ scores.

In the formula below, \(p\) denotes an individual pilot.
\begin{align*}
    SumOfFlownDistancesOverMinDist &= \sum_p \max(0, FlownDist_p - MinDist) \\
    NominalDistanceArea &= \frac{(a + b)}{2} \\
    a &= (NomGoal + 1) * (NomDist - MinDist) \\
    b &= \max(0, NomGoal * (BestDist - NomDist) \\
    DVR &= \frac{SumOfFlownDistancesOverMinDist}{NumberOfPilotsFlying * NominalDistanceArea} \\
    DistanceValidity &= \min(1, DVR)
\end{align*}

\subsection{Time Validity}
Time validity depends on the fastest time to complete the speed section, in relation to nominal time. If
the fastest time to complete the speed section is longer than nominal time, then time validity is always
equal to 1.

If the fastest time is quite short, the day is probably not a good measure of pilot skill because there
would not be many decisions to make and, because of this, luck can distort scores as there will be little
possibility to recover any accidental loss of time.

If no pilot finishes the speed section, then time validity is not based on time but on distance: The
distance of the pilot who flies the furthest in relation to nominal distance is then used to calculate the
time validity the same way as if it was the time.
\begin{align*}
    if \ one \ pilot \ reached \ ESS \\
    TVR &= \min(1, \frac{BestTime}{NominalTime}) \\
    if \ no \ pilot \ reached \ ESS \\
    TVR &= \min(1, \frac{BestDistance}{NominalDistance}) \\
    TimeValidity &= \max(0, \min(1, -0.271 + 2.912 * TVR - 2.098 * TVR^2 + 0.457 * TVR^3))
\end{align*}

\newpage
\section{Points Allocation}
The available points for each task are \(1000*TaskValidity\). These points are distributed between distance
points, time points, leading points and arrival points. The distribution depends on the percentage of
pilots who reached goal before the task deadline, compared to pilots who launched, as well as the
chosen goal form. It is expressed in terms of weight factors for each of the four point categories:
Distance weight, time weight, leading weight and arrival weight. Weight factors are always between 0
and 1. A weight factor of 0.5 for distance, for example, means that 50\% of the day’s available overall
points are available for distance points.
\begin{align*}
    GoalRatio &= \frac{NumberOfPilotsInGoal}{NumberOfPilotsFlying} \\
    DistanceWeight &= 0.9 - 1.665 * GoalRatio + 1.713 * GoalRatio^2 - 0.587 * GoalRatio^3 \\
    LeadingWeight &= \frac{1 - DistanceWeight}{8} * 1.4 \\
    GoalRatio = 0 : LeadingWeight &= \frac{BestDistance}{TaskDistance} * 0.1 \\
    GoalRatio > 0 : LeadingWeight &= \frac{1 - DistanceWeight}{8} * 1.4 * 2 \\
    ArrivalWeight &= \frac{1 - DistanceWeight}{8} \\
    ArrivalWeight &= 0 \\
    TimeWeight &= 1 - DistanceWeight - LeadingWeight - ArrivalWeight \\
    AvailableDistancePoints &= 1000 * TaskValidity  DistanceWeight \\
    AvailableTimePoints &= 1000 * TaskValidity * TimeWeight \\
    AvailableLeadingPoints &= 1000 * TaskValidity * LeadingWeight \\
    AvailableArrivalPoints &= 1000 * TaskValidity * ArrivalWeight
\end{align*}

\newpage
\section{Pilot score}
Each pilot’s score is the sum of that pilot’s distance, time, leading and arrival points, rounded to the
nearest whole number, 0.5 being rounded up.
\[ \forall p : p \in PilotsLaunched : TotalScore_p = DistancePoints_p + TimePoints_p + LeadingPoints_p + ArrivalPoints_p \]
\subsection{Distance points}
The distance considered for each pilot to calculate distance points is that pilot’s best distance along the
course line, up until the pilot landed or the task deadline was reached, whichever comes first.

One half of the available distance points are assigned to each pilot linearly, based on the pilot’s distance
flown in relation to the best distance flown in the task. The other half is assigned taking into
consideration the difficulty of the kilometers flown.
\begin{align*}
    LinearFraction_p &= \frac{Distance_p}{2 * BestDistance} \\
    i_p &= \lfloor Distance_p * 10 \rfloor \\
    DifficultyFraction_p &= DiffScore_{i_p} + ((DiffScore_{i_{p + 1}} - DiffScore_{i_p}) * (Distance_p * 10 - i_p)) \\
    DistancePoints_p &= (LinearFraction_p + DifficultyFraction_p) * AvailableDistancePoints
\end{align*}
In the case of a stopped task, a pilot’s distance may be increased by an altitude bonus (see~\ref{sec:distance-stopped-tasks}). The
available distance points are assigned to each pilot linearly, based on the pilot’s distance flown in
relation to the best distance flown in the task.
\[ DistancePoints_p = \frac{Distance_p}{BestDistance} * AvailableDistancePoints \]

\subsubsection{Difficulty calculation}
To measure the relative difficulty of each 100 meters of the task, we consider the number of pilots who
landed in the successive few kilometers, and the distance flown.

In a first step, for each 100-meter section of the task, the number of pilots who landed in that section is
counted. Pilots who landed before minimum distance are counted as having landed at minimum
distance. Only pilots who landed out are considered for this calculation, pilots who reached goal are not
counted.
\begin{align*}
    \forall i : i < \lfloor MinDist * 10 \rfloor : PilotsLanded_i &= 0 \\
    PilotsLanded_{\lfloor MinDist * 10 \rfloor} &= \sum_{\forall Pilot : \lfloor PilotDistance * 10 \rfloor \leq \lfloor MinDist * 10 \rfloor} 1 \\
    \forall i : i > \lfloor MinDist * 10 \rfloor \land i \leq \lfloor MaxDist * 10 \rfloor : PilotsLanded_i &= \sum_{\forall q : q \in PilotsLandedOut : \lfloor Distance_q * 10 \rfloor = i} 1
\end{align*}
Then the difficulty for each 100-meter section of the task is calculated by counting the number of pilots
who landed further along the task. If 100 pilots land out on a flight of 100 km, the next 3 km are
considered. If 10 pilots land out in 100 km, the next 30 km are considered. The variable LookAheadDist
contains the number of 100 meter slots to look ahead for this.
\begin{align*}
    LookAheadDist &= \max(30, round(\frac{30 * BestDistanceFlown}{NumberOfPilotsLandedOut}, 0)) \\
    \forall i : i < \lfloor MinDist * 10 \rfloor : Difficulty_i &= \sum_{j = i}^{j = \min(i + LookAheadDist, \lfloor BestDistanceFlown * 10 \rfloor)} PilotsLanded_j \\
    SumOfDifficulty = \sum_i Difficulty_i
\end{align*}
Relative difficulty is then calculated by dividing each 100-meter slot’s difficulty by twice the sum of all
difficulty values.
\[ \forall i : i \leq \lfloor MaxDist * 10 \rfloor : RelativeDifficulty_i = \frac{Difficulty_i}{2 * SumOfDifficulty} \]
Finally, we can calculate the difficulty score percentage for each 100-meter slot.
\begin{align*}
    \forall i : i < \lfloor MinDist * 10 \rfloor : DiffScore_i &= \sum_{j = 0}^{j = \lfloor MinDist * 10 \rfloor)} RelativeDifficulty_j \\
    \forall i : i > \lfloor MinDist * 10 \rfloor \land i < \lfloor BestDistanceFlown * 10 \rfloor : DiffScore_i &= \sum_{j = 0}^{j = i} RelativeDifficulty_j \\
    \forall i : i \geq \lfloor BestDistanceFlown * 10 \rfloor : DiffScore_i &= 0.5
\end{align*}
The difficulty calculation does not apply to paragliding.

\subsubsection{Example for difficulty calculation}
For an example of how the difficulty calculation works, see Figure 8: Note how the slope of the green
curve (the total Distance points) becomes steeper before an area where many pilots landed and flatter
just after. The red circles show these areas before the big group at the 41 km mark, and after the 46 km
mark. There are two reasons for this:
\begin{enumerate}
    \item For safety and retrieval reasons, we do not want to encourage pilots to fly only a short distance past a group of landed pilots.
    \item If a pilot lands somewhere, he or she probably got into trouble just before, and then glided a while before landing.
\end{enumerate}

\subsection{Time points}
Time points are assigned to the pilot as a function of best time and pilot time – the time the pilot took to
complete the speed section. Slow pilots will get zero points for speed if their time to complete the speed
section is equal to or longer than the fastest time plus the square root of the fastest time. All times are
measured in hours.
\begin{align*}
    SpeedFraction_p &= \max(0, 1 - \sqrt[3]{\frac{Time_p - BestTime}{\sqrt{BestTime}}}^2) \\
    TimePoints_p &= SpeedFraction_p * AvailableTimePoints
\end{align*}

\textit{Examples}

For three examples of Time Point distributions for tasks with different best times, see Figure 9 and Table~\ref{tab:time-points}.

\begin{table}[h!]
    \begin{tabularx}{\textwidth}{|r|r|r|R|}
    \hline
        \textbf{Fastest Time} & \textbf{80\% Time Points time} & \textbf{50\% Time Points time} & \textbf{0 Time Points time} \\
    \hline
        1:00 & 1:05 & 1:21 & 2:00 \\
    \hline
        2:00 & 2:08 & 2:30 & 3:24 (3.4 hours) \\
    \hline
        3:00 & 3:09 & 3:37 & 4:42 (4.7 hours) \\
    \hline
    \end{tabularx}
    \caption{Sample time points distribution (all times in hours:minutes)}
    \label{tab:time-points}
\end{table}

\subsection{Leading points}
Leading points are awarded to encourage pilots to start early and to reward the risk involved in flying in
the leading group. Pilots will get leading points even if they landed before goal or the end of speed
section.
\begin{align*}
    LC_{min} &= \min(\forall p : p \in PilotsFlown : LC_p) \\
    LeadingFactor_p &= \max(0, 1 - \sqrt[3]{\frac{LC_p - LC_{min}}{\sqrt{LC_{min}}}}^2) \\
    LeadingPoints_p &= LeadingFactor_p * AvailableLeadingPoints
\end{align*}
To get an impression of the way leading points are awarded depending on a task’s minimal leading
coefficient, see Figure 10.

\subsubsection{Leading coefficient}
Each started pilot’s track log is used to calculate the leading coefficient (LC), by calculating the area
underneath a graph defined by each track point’s time, and the distance to ESS at that time. The times
used for this calculation are given in seconds from the moment when the first pilot crossed SSS, to the
time when the last pilot reached ESS. For pilots who land out after the last pilot reached ESS, the
calculation keeps going until they land. The distances used for the LC calculation are given in kilometers
and are the distance from each point’s position to ESS, starting from SSS, but never more than any
previously reached distance. This means that the graph never “goes back”: even if the pilot flies away
from goal for a while, the corresponding points in the graph will use the previously reached best
distance towards ESS.

Calculation of the leading coefficient (LC) for each pilot follows this formula:
\begin{align*}
    LC_p &= \\
    \frac{\sum_{i : tp_i \in TrackPointsInSS_p} taskTime(tp_i) * (bestDistToESS(tp_{i - 1})^2 - bestDistToESS(tp_i)^2)}{1800 * LengthOfSpeedSection^2} \\
    \\
    \forall p : p \in PilotsLandedOut \land taskTime(tp_{max}) < ESSTime_{LastPilotAtESS} : LC_p &= \\
    LC_p + LastTime_{LastPilotAtESS} * bestDistToESS(tp_{max})^2 \\
    \\
    \forall p : p \in PilotsLandedOut \land taskTime(tp_{max}) \geq ESSTime_{LastPilotAtESS} : LC_p &= \\
    LC_p + taskTime(tp_{max}) * bestDistToESS(tp_{max})^2 \\
    \\
    taskTime(tp) &= \\
    \min(TaskDeadline, time(tp)) \\
    \\
    bestDistToESS(tp_0) &= \\
    LengthOfSpeedSection \\
    \\
    \forall i : i > 0 \land tp_i \in TrackPointsInSS_p : bestDistToESS(tp_i) &= \\
    \min(bestDistToESS(tp_{i - 1}), LenghtOfSpeedSection - distanceFlown(tp_i))
\end{align*}
In tasks where CESS is used, the CESS’s centre point is considered the last point of the speed section. For
LC calculations, any pilot crossing into the CESS’s cone is immediately awarded the remaining distance
to the cone’s centre.

\subsubsection{Example}
Blue was the first to enter the speed section, but Black was the first pilot to cross the end of speed
section. Green started at the same time as Blue, but landed short, after about 23km and just over 40
minutes of flight inside the speed section.

Black was fastest, therefore will get the most time points, but he started late, probably had pilots out
front to show the way during the first 22km, but was leading after that.

If a pilot lands along the course (Green), or if his track log is interrupted (Orange), his track log is
completed as shown by the dotted lines: Missing parts are calculated as if the dotted line was the actual
track log, so LC becomes bigger, lowering the leading points for that pilot, compared to a track where
that part is not missing. A pilot landing just short of goal will be less penalised and could even get full
leading points if he led for a long while.

The pilot who used best the earliest part of the day (i.e. Black, who has the smallest area below the
track log graph) gets all the available leading points, while the others gets their points according to the
same formula used for the time points for the same reasons. If the task in the example is fully valid, and
30\% of pilots reached goal, then Black will get all of the available 81 leading points and full time points,
as he was fastest; Blue gets 45 leading points because he started early but was slower; Orange receives
only 18 leading points as he was slow and had a gap in his track log; Green gets 0 points even though he
started early, because he was the slowest and landed fairly short.

\subsection{Arrival points}

\newpage
\section{Special cases}
\subsection{ESS but not goal}
\subsection{Early start}
\subsection{Stopped tasks}
\subsubsection{Stop task time}
\subsubsection{Requirements to score a stopped task}
\subsubsection{Stopped task validity}
\subsubsection{Scored time window}
\subsubsection{Time points for pilots at or after ESS}
\subsubsection{Distance points with altitude bonus}
\label{sec:distance-stopped-tasks}
\subsection{Penalties}

\newpage
\section{Task ranking}
\subsection{Overall task ranking}
\subsection{Female task ranking}
\subsection{Nation task ranking}

\newpage
\section{Competition ranking}
\subsection{Overall competition ranking}
\subsection{Female competition ranking}
\subsection{Nation competition ranking}
\subsection{Ties}

\newpage
\section{FTV - Fixed Total Validity}

\end{document}
